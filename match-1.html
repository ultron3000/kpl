<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>KPL Live Score - Titans vs Strikers</title>
<style>
  body{font-family:Inter,Arial,sans-serif;background:#0b132b;color:#fff;margin:0;padding:0}
  .container{max-width:900px;margin:40px auto;padding:20px;background:#1c2541;border-radius:10px}
  h1{text-align:center;color:#ffcc00;margin-bottom:5px}
  h2{color:#00c6ff;margin-top:20px}
  .score{text-align:center;font-size:2em;margin:10px 0}
  .section{background:#3a506b;margin-top:20px;padding:15px;border-radius:8px}
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{border-bottom:1px solid #555;padding:8px;text-align:left}
  th{color:#ffcc00}
  .footer{text-align:center;font-size:0.8em;color:#ccc;margin-top:10px}
  .error{text-align:center;color:#f87171;font-weight:600}
</style>
</head>
<body>
<div class="container">
  <h1 id="match-name">Loading...</h1>
  <div id="venue" style="text-align:center;color:#bbb"></div>
  <div class="score" id="summary">Loading...</div>
  <div id="innings"></div>
  <div class="footer">Auto-refresh every 10s • Powered by KPL Live Engine</div>
</div>

<script>
async function loadScore(){
  try{
    const res = await fetch('data/match-1.json?nocache='+Date.now());
    if(!res.ok) throw new Error('Match JSON not found');
    const data = await res.json();

    document.getElementById('match-name').textContent = data.title || data.match || "KPL Live Match";
    document.getElementById('venue').textContent = `${data.venue || ''} | ${data.status || 'LIVE'}`;
    
    const inning = data.innings[data.currentInnings || 0];
    const oversStr = inning.balls ? `${inning.overs}.${inning.balls}` : inning.overs;
    document.getElementById('summary').textContent = `${inning.team} ${inning.total}/${inning.wickets} (${oversStr} ov)`;

    const html = data.innings.map((inn, idx)=>{
      const overStr = inn.balls ? `${inn.overs}.${inn.balls}` : inn.overs;
      return `
      <div class="section">
        <h2>${inn.team} Innings</h2>
        <p><b>Score:</b> ${inn.total}/${inn.wickets} (${overStr} ov)
        <br><b>Extras:</b> ${inn.extras.total || 0} (Wd: ${inn.extras.wides}, Nb: ${inn.extras.noballs}, B: ${inn.extras.byes}, Lb: ${inn.extras.legbyes})
        </p>

        <h3>Batsmen</h3>
        <table>
          <tr><th>Name</th><th>R</th><th>B</th><th>4s</th><th>6s</th><th>Status</th></tr>
          ${(inn.battingOrder||[]).map(b=>`
            <tr>
              <td>${b.name}</td>
              <td>${b.runs}</td>
              <td>${b.balls}</td>
              <td>${b.fours}</td>
              <td>${b.sixes}</td>
              <td>${b.status}</td>
            </tr>
          `).join('')}
        </table>

        <h3>Bowlers</h3>
        <table>
          <tr><th>Name</th><th>O</th><th>R</th><th>W</th></tr>
          ${(inn.bowlers||[]).map(b=>{
            const ov = (b.overs||0) + (b.balls ? '.'+b.balls : '');
            return `<tr><td>${b.name}</td><td>${ov}</td><td>${b.runs}</td><td>${b.wickets}</td></tr>`;
          }).join('')}
        </table>

        ${inn.fallOfWickets && inn.fallOfWickets.length ? `
        <h3>Fall of Wickets</h3>
        <ul>${inn.fallOfWickets.map(f=>`<li>${f.batsman} - ${f.score} (${f.over})</li>`).join('')}</ul>
        `:''}

        ${inn.oversSummary && inn.oversSummary.length ? `
        <h3>Over Summary</h3>
        <ul>${inn.oversSummary.map(o=>`<li>Over ${o.over}: ${o.balls.join(', ')} — ${o.bowler}</li>`).join('')}</ul>
        `:''}

        ${inn.ballsDetailed && inn.ballsDetailed.length ? `
        <h3>Ball-by-Ball</h3>
        <pre>${inn.ballsDetailed.map((b,i)=>`${i+1}. O${b.over}.${b.ballInOver} — ${b.summary}`).join('\n')}</pre>
        `:''}
      </div>`;
    }).join('<hr>');

    document.getElementById('innings').innerHTML = html;
  } catch(err){
    document.getElementById('summary').innerHTML = `<div class='error'>❌ ${err.message}</div>`;
    console.error('Error loading match:',err);
  }
}
loadScore();
setInterval(loadScore, 10000);
</script>
</body>
</html>
