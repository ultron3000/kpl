<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>KPL Live - Match 1</title>
<style>
  body{font-family:Inter,Arial,sans-serif;background:#0b132b;color:#fff;margin:0;padding:0}
  .container{max-width:900px;margin:40px auto;padding:20px;background:#1c2541;border-radius:10px}
  h1{text-align:center;color:#ffcc00;margin-bottom:5px}
  h2{color:#00c6ff;margin-top:20px}
  .score{text-align:center;font-size:2em;margin:10px 0}
  .section{background:#3a506b;margin-top:20px;padding:15px;border-radius:8px}
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{border-bottom:1px solid #555;padding:8px;text-align:left}
  th{color:#ffcc00}
  .footer{text-align:center;font-size:0.8em;color:#ccc;margin-top:10px}
  .flash{animation:flashScore 0.8s ease-in-out}
  @keyframes flashScore{
    0%{background:#00c6ff;color:#000}
    100%{background:transparent;color:#fff}
  }
</style>
</head>
<body>
<div class="container">
  <h1 id="match-name">Loading...</h1>
  <div id="venue" style="text-align:center;color:#bbb"></div>
  <div class="score" id="summary">Loading...</div>
  <div id="innings"></div>
  <div class="footer">Auto-refresh every 10s â€¢ Redirects to summary on completion</div>
</div>

<script>
let prevScore="";
async function loadScore(){
  try{
    const res=await fetch('data/match-1.json?nocache='+Date.now());
    if(!res.ok) throw new Error('Match JSON not found');
    const data=await res.json();

    // redirect if match completed
    if((data.status||'').toLowerCase().includes('completed')){
      window.location.href='summary.html';
      return;
    }

    document.getElementById('match-name').textContent=data.title||data.match||"KPL Live Match";
    document.getElementById('venue').textContent=`${data.venue||''} | ${data.status||'LIVE'}`;

    const currentInn=data.innings[data.currentInnings||0];
    const oversStr=currentInn.balls?`${currentInn.overs}.${currentInn.balls}`:currentInn.overs;
    const scoreText=`${currentInn.team} ${currentInn.total}/${currentInn.wickets} (${oversStr} ov)`;
    const scoreDiv=document.getElementById('summary');
    scoreDiv.textContent=scoreText;
    if(scoreText!==prevScore){scoreDiv.classList.add('flash');setTimeout(()=>scoreDiv.classList.remove('flash'),800);}
    prevScore=scoreText;

    const html=data.innings.map((inn,idx)=>{
      const overStr=inn.balls?`${inn.overs}.${inn.balls}`:inn.overs;
      return `
      <div class="section">
        <h2>${inn.team} Innings</h2>
        <p><b>Score:</b> ${inn.total}/${inn.wickets} (${overStr} ov)<br>
        <b>Extras:</b> ${inn.extras.total||0} (Wd:${inn.extras.wides}, Nb:${inn.extras.noballs}, B:${inn.extras.byes}, Lb:${inn.extras.legbyes})</p>

        <h3>Batsmen</h3>
        <table>
          <tr><th>Name</th><th>R</th><th>B</th><th>4s</th><th>6s</th><th>Status</th></tr>
          ${(inn.battingOrder||[]).map(b=>`
            <tr><td>${b.name}</td><td>${b.runs}</td><td>${b.balls}</td><td>${b.fours}</td><td>${b.sixes}</td><td>${b.status}</td></tr>`).join('')}
        </table>

        <h3>Bowlers</h3>
        <table>
          <tr><th>Name</th><th>O</th><th>R</th><th>W</th></tr>
          ${(inn.bowlers||[]).map(b=>{
            const ov=(b.overs||0)+(b.balls?'.'+b.balls:'');
            return `<tr><td>${b.name}</td><td>${ov}</td><td>${b.runs}</td><td>${b.wickets}</td></tr>`;
          }).join('')}
        </table>

        ${inn.fallOfWickets && inn.fallOfWickets.length ? `
        <h3>Fall of Wickets</h3>
        <ul>${inn.fallOfWickets.map(f=>`<li>${f.batsman} - ${f.score} (${f.over})</li>`).join('')}</ul>`:''}
      </div>`;
    }).join('<hr>');

    document.getElementById('innings').innerHTML=html;
  }catch(err){
    document.getElementById('summary').innerHTML=`<div style='color:red;text-align:center'>${err.message}</div>`;
  }
}
loadScore();
setInterval(loadScore,10000);
</script>
</body>
</html>
