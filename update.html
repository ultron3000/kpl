<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>KPL Live Scorer ‚Äî Ball by Ball with Over Summary</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {font-family:Poppins,sans-serif;background:#f2f3f8;padding:20px;max-width:1000px;margin:auto;}
.card {background:white;padding:20px;margin:15px 0;border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,0.1);}
h1,h3{text-align:center;}
input,select{width:100%;padding:8px;margin:6px 0;border:1px solid #ccc;border-radius:6px;}
button{border:none;background:#007bff;color:white;padding:10px 16px;border-radius:6px;margin:3px;cursor:pointer;}
button:hover{background:#0056b3;}
.extras button{background:#ffc107;color:black;}
.wicket button{background:#dc3545;}
.runButtons{display:flex;flex-wrap:wrap;justify-content:center;}
.runButtons button{min-width:50px;font-weight:bold;}
.success{color:green;} .error{color:red;}
#msg{text-align:center;margin-top:10px;}
#overSummary{background:#fafafa;padding:10px;border-radius:8px;margin-top:10px;font-family:monospace;line-height:1.5;}
</style>
</head>
<body>

<h1>üèè KPL Live Scorer ‚Äî Over Summary Mode</h1>

<!-- LOGIN -->
<div id="loginBox" class="card">
  <h3>üîê Enter PIN</h3>
  <input type="password" id="pin" placeholder="Enter Admin PIN">
  <button onclick="checkPin()">Login</button>
  <p id="loginMsg"></p>
</div>

<!-- SCORER -->
<div id="scorer" style="display:none;">

  <div class="card">
    <h3>‚öôÔ∏è GitHub Setup</h3>
    <input id="username" placeholder="GitHub Username (e.g. ultron3000)">
    <input id="token" type="password" placeholder="GitHub Token (starts with ghp_)">
  </div>

  <div class="card">
    <h3>üèÜ Match Setup</h3>
    <select id="matchFile">
      <option value="match-1.json">Match 1: Titans vs Strikers</option>
      <option value="match-2.json">Match 2: Warriors vs Challengers</option>
    </select>
    <input id="teamA" placeholder="Team A Name">
    <input id="teamB" placeholder="Team B Name">
    <select id="battingTeam">
      <option value="A">Team A Batting</option>
      <option value="B">Team B Batting</option>
    </select>
    <input id="striker" placeholder="Striker Name">
    <input id="nonStriker" placeholder="Non-Striker Name">
    <input id="bowler" placeholder="Bowler Name">
    <input id="venue" placeholder="Venue">
    <input id="status" placeholder="Status (LIVE / Completed)">
  </div>

  <div class="card">
    <h3>üéØ Ball-by-Ball Scoring</h3>
    <p id="liveScore">Score: 0/0 (0.0)</p>

    <div class="runButtons">
      <button onclick="addRun(0)">0</button>
      <button onclick="addRun(1)">1</button>
      <button onclick="addRun(2)">2</button>
      <button onclick="addRun(3)">3</button>
      <button onclick="addRun(4)">4</button>
      <button onclick="addRun(6)">6</button>
    </div>

    <h4>Extras</h4>
    <div class="extras runButtons">
      <button onclick="addExtra('wide')">Wide</button>
      <button onclick="addExtra('noball')">No Ball</button>
      <button onclick="addExtra('bye')">Bye</button>
      <button onclick="addExtra('legbye')">Leg Bye</button>
      <button onclick="toggleFreeHit()">Free Hit: <span id="freeHitStatus">OFF</span></button>
    </div>

    <h4>Wickets</h4>
    <div class="wicket runButtons">
      <button onclick="addWicket('bowled')">Bowled</button>
      <button onclick="addWicket('caught')">Caught</button>
      <button onclick="addWicket('runout')">Run Out</button>
      <button onclick="addWicket('lbw')">LBW</button>
    </div>

    <p>Current Over: <span id="balls">0</span> balls</p>
    <div id="overSummary">Over Summary: ‚Äî</div>
  </div>

  <div class="card">
    <button onclick="updateGitHub()">üíæ Save & Push to GitHub</button>
    <p id="msg"></p>
  </div>
</div>

<script>
const PIN = "4278";
let isFreeHit = false;
let overBalls = [];

let matchData = {
  teamA: { name:"", score:0, wickets:0, overs:0, balls:0, extras:0 },
  teamB: { name:"", score:0, wickets:0, overs:0, balls:0, extras:0 },
  striker:"", nonStriker:"", bowler:"",
  oversSummary:[],
  venue:"", status:"LIVE", lastUpdated:""
};

function checkPin(){
  if(document.getElementById("pin").value===PIN){
    document.getElementById("loginBox").style.display="none";
    document.getElementById("scorer").style.display="block";
  } else {
    document.getElementById("loginMsg").innerHTML='<span class="error">‚ùå Wrong PIN!</span>';
  }
}

function getBatting(){return document.getElementById("battingTeam").value==="A"?"teamA":"teamB";}

function toggleFreeHit(){
  isFreeHit=!isFreeHit;
  document.getElementById("freeHitStatus").innerText=isFreeHit?"ON":"OFF";
}

// ‚úÖ Add Run
function addRun(runs){
  const t=getBatting();
  matchData[t].score+=runs;
  recordBall(runs);
  addBall(); // legal delivery
  updateDisplay();
}

// ‚úÖ Add Extras
function addExtra(type){
  const t=getBatting();
  let label="";
  switch(type){
    case "wide": label="Wd"; break;
    case "noball": label="Nb"; break;
    case "bye": label="B"; break;
    case "legbye": label="Lb"; break;
  }

  // add 1 run for the extra
  matchData[t].score+=1;
  matchData[t].extras+=1;

  // wide and no ball do NOT count as legal deliveries
  const legal = !(type==="wide" || type==="noball");
  recordBall(label);
  if(legal) addBall();

  updateDisplay();
}

// ‚úÖ Add Wicket
function addWicket(kind){
  const t=getBatting();
  if(isFreeHit){
    alert("Free hit! No wicket.");
    isFreeHit=false;
    document.getElementById("freeHitStatus").innerText="OFF";
    return;
  }
  matchData[t].wickets+=1;
  recordBall("W");
  addBall();
  updateDisplay();
}

// ‚úÖ Record Ball in Over Summary
function recordBall(symbol){
  overBalls.push(symbol);
  document.getElementById("overSummary").innerText=`Over Summary: ${overBalls.join(" | ")}`;
}

// ‚úÖ Handle legal ball progression
function addBall(){
  const t=getBatting();
  matchData[t].balls+=1;
  if(matchData[t].balls===6){
    matchData[t].overs+=1;
    matchData[t].balls=0;
    matchData.oversSummary.push({
      over: matchData[t].overs,
      balls:[...overBalls],
      bowler: document.getElementById("bowler").value
    });
    overBalls=[];
    document.getElementById("overSummary").innerText="Over Summary: ‚Äî";
  }
}

// ‚úÖ Update score display
function updateDisplay(){
  const t=getBatting();
  const d=matchData[t];
  document.getElementById("liveScore").innerText=
    `${d.score}/${d.wickets} (${d.overs}.${d.balls}) | Extras: ${d.extras}`;
  document.getElementById("balls").innerText=d.balls;
}

// ‚úÖ Push JSON to GitHub
async function updateGitHub(){
  matchData.teamA.name=document.getElementById("teamA").value;
  matchData.teamB.name=document.getElementById("teamB").value;
  matchData.striker=document.getElementById("striker").value;
  matchData.nonStriker=document.getElementById("nonStriker").value;
  matchData.bowler=document.getElementById("bowler").value;
  matchData.venue=document.getElementById("venue").value;
  matchData.status=document.getElementById("status").value;
  matchData.lastUpdated=new Date().toLocaleString();

  const jsonStr=JSON.stringify(matchData,null,2);
  const user=document.getElementById("username").value.trim();
  const token=document.getElementById("token").value.trim();
  const file=document.getElementById("matchFile").value;
  const apiURL=`https://api.github.com/repos/${user}/kpl/contents/data/${file}`;

  try{
    const getRes=await fetch(apiURL,{headers:{Authorization:`token ${token}`}});
    const getData=await getRes.json();
    const sha=getData.sha;

    const putBody={
      message:`Live update ${file}`,
      content:btoa(unescape(encodeURIComponent(jsonStr))),
      sha
    };

    const putRes=await fetch(apiURL,{
      method:"PUT",
      headers:{Authorization:`token ${token}`,"Content-Type":"application/json"},
      body:JSON.stringify(putBody)
    });

    if(putRes.ok){
      document.getElementById("msg").innerHTML='<span class="success">‚úÖ Updated successfully!</span>';
    }else{
      const err=await putRes.json();
      document.getElementById("msg").innerHTML=`<span class="error">${err.message}</span>`;
    }
  }catch(err){
    document.getElementById("msg").innerHTML=`<span class="error">${err.message}</span>`;
  }
}
</script>
</body>
</html>
