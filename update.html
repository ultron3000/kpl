<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>KPL Live Admin ‚Äî Protected</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family:Poppins, sans-serif; background:#f4f4f4; padding:20px; max-width:900px; margin:auto; }
  h1 { text-align:center; color:#111; }
  input, select, textarea {
    width:100%; padding:10px; margin:6px 0; border:1px solid #ccc; border-radius:6px;
  }
  button { background:#007bff; color:white; border:none; padding:10px 16px; border-radius:6px; cursor:pointer; }
  button:hover { background:#0056b3; }
  .card { background:white; padding:20px; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.1); margin-bottom:15px; }
  pre { background:#111; color:#0f0; padding:10px; border-radius:8px; overflow-x:auto; }
  .error{color:red;} .success{color:green;}
</style>
</head>
<body>

<h1>üèè KPL Live Score Admin</h1>

<!-- LOGIN -->
<div id="loginBox" class="card">
  <h3>üîê Enter Admin PIN</h3>
  <input type="password" id="adminPin" placeholder="Enter PIN">
  <button onclick="checkPin()">Login</button>
  <p id="loginMsg"></p>
</div>

<!-- ADMIN PANEL -->
<div id="adminPanel" style="display:none;">
  <div class="card">
    <h3>‚öôÔ∏è GitHub Setup</h3>
    <input id="username" placeholder="GitHub Username (e.g. ultron3000)">
    <input id="token" type="password" placeholder="GitHub Token (starts with ghp_)">
  </div>

  <div class="card">
    <h3>üèÜ Select Match</h3>
    <select id="matchFile">
      <option value="match-1.json">Match 1: Titans vs Strikers</option>
      <option value="match-2.json">Match 2: Warriors vs Challengers</option>
      <option value="match-3.json">Match 3: Blazers vs Spartans</option>
      <option value="match-4.json">Match 4: Royals vs Mavericks</option>
      <option value="match-5.json">Match 5: Thunderbolts vs Gladiators</option>
    </select>
  </div>

  <div class="card">
    <h3>üèè Team A ‚Äî 1st Innings</h3>
    <input id="teamA" placeholder="Team A Name">
    <input id="teamAScore" placeholder="Score (e.g. 125/5)">
    <input id="teamAOvers" placeholder="Overs (e.g. 15.3)">
  </div>

  <div class="card">
    <h3>üèè Team B ‚Äî 2nd Innings</h3>
    <input id="teamB" placeholder="Team B Name">
    <input id="teamBScore" placeholder="Score (e.g. 110/4)">
    <input id="teamBOvers" placeholder="Overs (e.g. 14.5)">
  </div>

  <div class="card">
    <h3>üìä Match Info</h3>
    <input id="venue" placeholder="Venue (e.g. KPL Ground)">
    <input id="status" placeholder="Status (LIVE / Completed / Upcoming)">
  </div>

  <div class="card">
    <button onclick="generate()">Generate JSON</button>
    <pre id="output">-- JSON will appear here --</pre>
    <button onclick="updateGitHub()">Save to GitHub</button>
    <p id="msg"></p>
  </div>
</div>

<script>
const ADMIN_PIN = "4278"; // ‚úÖ Your PIN

function checkPin() {
  const entered = document.getElementById("adminPin").value.trim();
  if (entered === ADMIN_PIN) {
    localStorage.setItem("kplAdmin", "true");
    document.getElementById("loginBox").style.display = "none";
    document.getElementById("adminPanel").style.display = "block";
  } else {
    document.getElementById("loginMsg").innerHTML = '<span class="error">‚ùå Wrong PIN!</span>';
  }
}
window.onload = () => {
  if (localStorage.getItem("kplAdmin") === "true") {
    document.getElementById("loginBox").style.display = "none";
    document.getElementById("adminPanel").style.display = "block";
  }
};

let latestJSON = "";

function generate() {
  const data = {
    teamA: {
      name: document.getElementById("teamA").value,
      score: document.getElementById("teamAScore").value,
      overs: document.getElementById("teamAOvers").value
    },
    teamB: {
      name: document.getElementById("teamB").value,
      score: document.getElementById("teamBScore").value,
      overs: document.getElementById("teamBOvers").value
    },
    venue: document.getElementById("venue").value,
    status: document.getElementById("status").value,
    lastUpdated: new Date().toLocaleString()
  };

  latestJSON = JSON.stringify(data, null, 2);
  document.getElementById("output").textContent = latestJSON;
  document.getElementById("msg").innerHTML = "";
}

async function updateGitHub() {
  const user = document.getElementById("username").value.trim();
  const token = document.getElementById("token").value.trim();
  const file = document.getElementById("matchFile").value;

  if (!user || !token) return alert("Enter GitHub username and token");
  if (!latestJSON) return alert("Generate JSON first!");

  const repo = "kpl";
  const path = "data/" + file;
  const apiURL = `https://api.github.com/repos/${user}/${repo}/contents/${path}`;

  try {
    const getRes = await fetch(apiURL, { headers: { Authorization: `token ${token}` }});
    const getData = await getRes.json();
    const sha = getData.sha;

    const body = {
      message: `Auto update ${file}`,
      content: btoa(unescape(encodeURIComponent(latestJSON))),
      sha
    };

    const putRes = await fetch(apiURL, {
      method: "PUT",
      headers: { Authorization: `token ${token}`, "Content-Type": "application/json" },
      body: JSON.stringify(body)
    });

    if (putRes.ok) {
      document.getElementById("msg").innerHTML = `<span class="success">‚úÖ Updated ${file} successfully!</span>`;
    } else {
      const err = await putRes.json();
      document.getElementById("msg").innerHTML = `<span class="error">‚ùå ${err.message}</span>`;
    }
  } catch (err) {
    document.getElementById("msg").innerHTML = `<span class="error">‚ùå ${err.message}</span>`;
  }
}
</script>
</body>
</html>
