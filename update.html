<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>KPL Scorer ‚Äî Match 1 (Titans vs Strikers)</title>
<style>
body{font-family:Inter,Arial,sans-serif;background:#f5f9ff;padding:18px;max-width:1200px;margin:auto;}
.card{background:#fff;border-radius:10px;padding:12px;box-shadow:0 6px 20px rgba(18,38,63,0.06);}
h1{margin-bottom:10px;color:#0b132b;}
button{cursor:pointer;border:0;border-radius:6px;padding:8px 12px;font-weight:600;}
.btnRun{background:#0b69ff;color:#fff;}
.btnExtra{background:#fbbf24;color:#000;}
.btnWicket{background:#ef4444;color:#fff;}
.btnSave{background:#059669;color:#fff;margin-top:10px;}
.status{color:#0b69ff;font-weight:700;}
select,input{padding:6px;border:1px solid #cbd5e1;border-radius:6px;}
#msg{margin-top:8px;font-size:14px;}
</style>
</head>
<body>
<h1>üèè KPL Scorer ‚Äî Match 1 (Titans vs Strikers)</h1>

<div class="card">
  <h2>Live Match Status</h2>
  <div id="livePanel">Loading...</div>
</div>

<br>

<div class="card">
  <h2>Scoring Console</h2>

  <label>Innings</label>
  <select id="inningSel">
    <option value="0">1st Innings ‚Äî Titans Batting</option>
    <option value="1">2nd Innings ‚Äî Strikers Batting</option>
  </select>

  <br><br>
  <label>Striker</label>
  <select id="strikerSel"></select>
  <label>Non-Striker</label>
  <select id="nonSel"></select>
  <label>Bowler</label>
  <select id="bowlerSel"></select>

  <br><br>
  <div>
    <button class="btnRun" onclick="ball(0)">0</button>
    <button class="btnRun" onclick="ball(1)">1</button>
    <button class="btnRun" onclick="ball(2)">2</button>
    <button class="btnRun" onclick="ball(3)">3</button>
    <button class="btnRun" onclick="ball(4)">4</button>
    <button class="btnRun" onclick="ball(6)">6</button>
    <button class="btnExtra" onclick="extra('wide')">Wide</button>
    <button class="btnExtra" onclick="extra('noball')">No Ball</button>
    <button class="btnExtra" onclick="extra('bye')">Bye</button>
    <button class="btnExtra" onclick="extra('legbye')">Leg Bye</button>
    <button class="btnWicket" onclick="wicket()">Wicket</button>
  </div>

  <button class="btnSave" onclick="saveData()">Force Save & Push</button>
  <div id="msg"></div>
</div>

<script>
const ADMIN_PIN="4278";
const BALLS_PER_OVER=6;
const REPO="kpl",BRANCH="main";

let match={
  title:"Titans vs Strikers",
  venue:"KPL Arena 1",
  status:"LIVE",
  currentInnings:0,
  innings:[
    {team:"Titans",total:0,wickets:0,overs:0,balls:0,extras:{wides:0,noballs:0,byes:0,legbyes:0,total:0},battingOrder:[],bowlers:[],fallOfWickets:[],ballsDetailed:[]},
    {team:"Strikers",total:0,wickets:0,overs:0,balls:0,extras:{wides:0,noballs:0,byes:0,legbyes:0,total:0},battingOrder:[],bowlers:[],fallOfWickets:[],ballsDetailed:[]}
  ],
  teams:{
    Titans:["Rohit Sharma","Virat Kohli","Shreyas Iyer","Hardik Pandya","Suryakumar Yadav","Rishabh Pant","Ravindra Jadeja","Bhuvneshwar Kumar","Jasprit Bumrah","Mohammed Shami","Yuzvendra Chahal"],
    Strikers:["Prithvi Shaw","Shikhar Dhawan","KL Rahul","Sanju Samson","Ruturaj Gaikwad","Axar Patel","Deepak Hooda","Mohammed Siraj","Kuldeep Yadav","Arshdeep Singh","Umran Malik"]
  },
  current:{striker:null,nonStriker:null,bowler:null}
};

function $(id){return document.getElementById(id);}

function init(){
  populatePlayers();
  updatePanel();
}

function populatePlayers(){
  const idx=Number($("inningSel").value);
  match.currentInnings=idx;
  const battingTeam=idx===0?"Titans":"Strikers";
  const bowlingTeam=idx===0?"Strikers":"Titans";

  const batsmen=match.teams[battingTeam];
  const bowlers=match.teams[bowlingTeam];

  $("strikerSel").innerHTML=batsmen.map(p=>`<option>${p}</option>`).join('');
  $("nonSel").innerHTML=batsmen.map(p=>`<option>${p}</option>`).join('');
  $("bowlerSel").innerHTML=bowlers.map(p=>`<option>${p}</option>`).join('');

  match.current.striker=batsmen[0];
  match.current.nonStriker=batsmen[1];
  match.current.bowler=bowlers[bowlers.length-1];

  const inn=match.innings[idx];
  if(inn.battingOrder.length===0){
    inn.battingOrder=batsmen.map(n=>({name:n,runs:0,balls:0,fours:0,sixes:0,status:"not out"}));
  }
  if(inn.bowlers.length===0){
    inn.bowlers=bowlers.map(n=>({name:n,overs:0,balls:0,runs:0,wickets:0}));
  }

  updatePanel();
}

function getBatsman(inn,name){return inn.battingOrder.find(x=>x.name===name);}
function getBowler(inn,name){return inn.bowlers.find(x=>x.name===name);}

function updatePanel(){
  const inn=match.innings[match.currentInnings];
  const oversFloat=inn.overs+(inn.balls/BALLS_PER_OVER);
  const rr=oversFloat?(inn.total/oversFloat).toFixed(2):"0.00";
  $("livePanel").innerHTML=`
  <b>${inn.team}</b><br>
  Score: <span class="status">${inn.total}/${inn.wickets}</span> (${inn.overs}.${inn.balls} ov)<br>
  Run Rate: ${rr}<br>
  Striker: ${match.current.striker||'-'} | Non-striker: ${match.current.nonStriker||'-'}<br>
  Bowler: ${match.current.bowler||'-'}
  `;
}

function ball(runs){
  const inn=match.innings[match.currentInnings];
  const striker=match.current.striker;
  const bowler=match.current.bowler;
  const batsmanObj=getBatsman(inn,striker);
  const bowlerObj=getBowler(inn,bowler);

  batsmanObj.runs+=runs;
  batsmanObj.balls+=1;
  if(runs===4)batsmanObj.fours+=1;
  if(runs===6)batsmanObj.sixes+=1;
  bowlerObj.runs+=runs;
  bowlerObj.balls+=1;

  inn.total+=runs;
  inn.balls+=1;
  inn.ballsDetailed.push({over:inn.overs,ball:inn.balls,striker,bowler,runs});

  // odd runs swap striker
  if(runs%2===1){[match.current.striker,match.current.nonStriker]=[match.current.nonStriker,match.current.striker];}

  if(inn.balls>=BALLS_PER_OVER){
    inn.overs+=1;
    inn.balls=0;
    bowlerObj.overs+=1;
    bowlerObj.balls=0;
    [match.current.striker,match.current.nonStriker]=[match.current.nonStriker,match.current.striker];
    autoPush();
  }
  updatePanel();
}

function extra(type){
  const inn=match.innings[match.currentInnings];
  const bowlerObj=getBowler(inn,match.current.bowler);
  inn.extras.total++;
  inn.total++;
  inn.extras[type+'s']=(inn.extras[type+'s']||0)+1;
  bowlerObj.runs++;
  updatePanel();
}

function wicket(){
  const inn=match.innings[match.currentInnings];
  const striker=match.current.striker;
  const bowler=match.current.bowler;
  const batsmanObj=getBatsman(inn,striker);
  const bowlerObj=getBowler(inn,bowler);

  batsmanObj.status="out";
  bowlerObj.wickets+=1;
  inn.wickets+=1;
  inn.fallOfWickets.push(`${striker} ${inn.total}/${inn.wickets}`);

  const nextBatsman=inn.battingOrder.find(x=>x.status==="not out" && x!==batsmanObj);
  if(nextBatsman){
    match.current.striker=nextBatsman.name;
  }
  updatePanel();
}

function saveData(){autoPush(true);}

async function autoPush(force){
  $("msg").innerText="Saving to GitHub...";
  const user=localStorage.getItem("ghUser")||prompt("GitHub username:","ultron3000");
  const token=localStorage.getItem("ghToken")||prompt("GitHub token:");
  localStorage.setItem("ghUser",user);
  localStorage.setItem("ghToken",token);
  const file="match-1.json";
  const api=`https://api.github.com/repos/${user}/${REPO}/contents/data/${file}`;
  const get=await fetch(api+`?ref=${BRANCH}`,{headers:{Authorization:`token ${token}`}});
  const j=await get.json();const sha=j.sha||null;
  const content=btoa(unescape(encodeURIComponent(JSON.stringify(match,null,2))));
  const body={message:"KPL update",content,branch:BRANCH};if(sha)body.sha=sha;
  const put=await fetch(api,{method:"PUT",headers:{Authorization:`token ${token}`,"Content-Type":"application/json"},body:JSON.stringify(body)});
  $("msg").innerText=put.ok?"Saved to GitHub ‚úÖ":"Error saving";
}

$("inningSel").addEventListener("change",populatePlayers);
init();
</script>
</body>
</html>
