<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>KPL Live Scorer ‚Äî Visual Dashboard Mode</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {font-family:Poppins,sans-serif;background:#f5f7fa;padding:20px;max-width:1200px;margin:auto;}
.dashboard {display:grid;grid-template-columns:2fr 1fr;gap:20px;}
.card {background:white;padding:20px;border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,0.1);}
h1,h3{text-align:center;}
input,select{width:100%;padding:8px;margin:6px 0;border:1px solid #ccc;border-radius:6px;}
button{border:none;background:#007bff;color:white;padding:10px 16px;border-radius:6px;margin:3px;cursor:pointer;}
button:hover{background:#0056b3;}
.runButtons{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;}
.runButtons button{min-width:50px;font-weight:bold;}
.success{color:green;} .error{color:red;}
#msg{text-align:center;margin-top:10px;}
#scoreboard{text-align:center;font-size:1.3rem;font-weight:600;margin-bottom:10px;}
.batting-info,.bowler-info{background:#f9fafb;padding:10px;border-radius:8px;margin:6px 0;}
#overSummary{background:#fafafa;padding:10px;border-radius:8px;margin-top:10px;font-family:monospace;line-height:1.5;}
</style>
</head>
<body>

<h1>üèè KPL Live Scorer Dashboard</h1>

<!-- PIN LOGIN -->
<div id="loginBox" class="card">
  <h3>üîê Enter PIN</h3>
  <input type="password" id="pin" placeholder="Enter Admin PIN">
  <button onclick="checkPin()">Login</button>
  <p id="loginMsg"></p>
</div>

<!-- DASHBOARD -->
<div id="scorer" style="display:none;">
  <div class="dashboard">
    <!-- LEFT SIDE: SCORING -->
    <div class="card">
      <h3>üèè Live Match Panel</h3>
      <div id="scoreboard">Score: 0/0 (0.0)</div>

      <div class="batting-info">
        <b>Striker:</b> <span id="strikerName">‚Äì</span><br>
        <b>Non-Striker:</b> <span id="nonStrikerName">‚Äì</span><br>
        <b>Bowler:</b> <span id="bowlerName">‚Äì</span>
      </div>

      <div id="overSummary">Over Summary: ‚Äî</div>

      <h4>üèÉ Runs</h4>
      <div class="runButtons">
        <button onclick="addRun(0)">0</button><button onclick="addRun(1)">1</button>
        <button onclick="addRun(2)">2</button><button onclick="addRun(3)">3</button>
        <button onclick="addRun(4)">4</button><button onclick="addRun(6)">6</button>
      </div>

      <h4>Extras</h4>
      <div class="runButtons">
        <button style="background:#ffc107" onclick="addExtra('wide')">Wide</button>
        <button style="background:#ffc107" onclick="addExtra('noball')">No Ball</button>
        <button style="background:#ffc107" onclick="addExtra('bye')">Bye</button>
        <button style="background:#ffc107" onclick="addExtra('legbye')">Leg Bye</button>
        <button style="background:#6f42c1" onclick="toggleFreeHit()">Free Hit: <span id="freeHitStatus">OFF</span></button>
      </div>

      <h4>Wicket</h4>
      <div class="runButtons">
        <button style="background:#dc3545" onclick="addWicket()">Wicket</button>
      </div>
    </div>

    <!-- RIGHT SIDE: MATCH INFO -->
    <div class="card">
      <h3>‚öôÔ∏è Match Settings</h3>
      <select id="matchFile">
        <option value="match-1.json">Match 1: Titans vs Strikers</option>
      </select>
      <input id="teamA" placeholder="Team A Name (e.g. Titans)">
      <input id="teamB" placeholder="Team B Name (e.g. Strikers)">
      <select id="battingTeam"><option value="A">Team A Batting</option><option value="B">Team B Batting</option></select>
      <input id="striker" placeholder="Striker Name">
      <input id="nonStriker" placeholder="Non-Striker Name">
      <input id="bowler" placeholder="Bowler Name">
      <input id="venue" placeholder="Venue">
      <input id="status" placeholder="Status (LIVE / Completed)">
      <input id="username" placeholder="GitHub Username (e.g. ultron3000)">
      <input id="token" type="password" placeholder="GitHub Token (starts with ghp_)">
      <button onclick="updateGitHub()">üíæ Save & Push</button>
      <p id="msg"></p>
    </div>
  </div>
</div>

<script>
const PIN = "4278";
let isFreeHit = false;
let overBalls = [];

let matchData = {
  teamA: {name:"",score:0,wickets:0,overs:0,balls:0,extras:0},
  teamB: {name:"",score:0,wickets:0,overs:0,balls:0,extras:0},
  striker:"", nonStriker:"", bowler:"",
  wickets:[], oversSummary:[], venue:"", status:"LIVE", lastUpdated:""
};

function checkPin(){
  if(document.getElementById("pin").value===PIN){
    document.getElementById("loginBox").style.display="none";
    document.getElementById("scorer").style.display="block";
  } else {
    document.getElementById("loginMsg").innerHTML='<span class="error">‚ùå Wrong PIN!</span>';
  }
}

function getBatting(){return document.getElementById("battingTeam").value==="A"?"teamA":"teamB";}
function toggleFreeHit(){isFreeHit=!isFreeHit;document.getElementById("freeHitStatus").innerText=isFreeHit?"ON":"OFF";}

function addRun(runs){
  const t=getBatting();
  matchData[t].score+=runs;
  recordBall(runs);
  addBall();updateDisplay();
}

function addExtra(type){
  const t=getBatting();
  matchData[t].score+=1;matchData[t].extras+=1;
  const label=type==="wide"?"Wd":type==="noball"?"Nb":type==="bye"?"B":"Lb";
  recordBall(label);
  const legal=!(type==="wide"||type==="noball");
  if(legal)addBall();
  updateDisplay();
}

function addWicket(){
  const t=getBatting();
  if(isFreeHit){alert("Free hit ‚Äî no wicket!");isFreeHit=false;document.getElementById("freeHitStatus").innerText="OFF";return;}
  const outPlayer=prompt("Who got out?");
  const how=prompt("How? (bowled, caught, run out, etc)");
  matchData[t].wickets+=1;
  matchData.wickets.push({player:outPlayer,how});
  recordBall("W");
  addBall();
  const newBatsman=prompt("New batsman name?");
  matchData.nonStriker=matchData.striker;
  matchData.striker=newBatsman;
  document.getElementById("strikerName").innerText=newBatsman;
  document.getElementById("nonStrikerName").innerText=matchData.nonStriker;
  updateDisplay();
}

function recordBall(symbol){overBalls.push(symbol);document.getElementById("overSummary").innerText=`Over Summary: ${overBalls.join(" | ")}`;}

function addBall(){
  const t=getBatting();
  matchData[t].balls++;
  if(matchData[t].balls===6){
    matchData[t].overs++;
    matchData[t].balls=0;
    matchData.oversSummary.push({over:matchData[t].overs,balls:[...overBalls],bowler:matchData.bowler});
    overBalls=[];
    document.getElementById("overSummary").innerText="Over Summary: ‚Äî";
  }
}

function updateDisplay(){
  const t=getBatting();const d=matchData[t];
  document.getElementById("scoreboard").innerText=`${d.score}/${d.wickets} (${d.overs}.${d.balls}) | Extras: ${d.extras}`;
  document.getElementById("strikerName").innerText=document.getElementById("striker").value||"‚Äì";
  document.getElementById("nonStrikerName").innerText=document.getElementById("nonStriker").value||"‚Äì";
  document.getElementById("bowlerName").innerText=document.getElementById("bowler").value||"‚Äì";
}

async function updateGitHub(){
  matchData.teamA.name=document.getElementById("teamA").value;
  matchData.teamB.name=document.getElementById("teamB").value;
  matchData.striker=document.getElementById("striker").value;
  matchData.nonStriker=document.getElementById("nonStriker").value;
  matchData.bowler=document.getElementById("bowler").value;
  matchData.venue=document.getElementById("venue").value;
  matchData.status=document.getElementById("status").value;
  matchData.lastUpdated=new Date().toLocaleString();

  const jsonStr=JSON.stringify(matchData,null,2);
  const user=document.getElementById("username").value.trim();
  const token=document.getElementById("token").value.trim();
  const file=document.getElementById("matchFile").value;
  const apiURL=`https://api.github.com/repos/${user}/kpl/contents/data/${file}?ref=main`;

  try{
    const getRes=await fetch(apiURL,{headers:{Authorization:`token ${token}`}});
    const getData=await getRes.json();
    const sha=getData.sha;

    const putBody={
      message:`Auto update ${file}`,
      content:btoa(unescape(encodeURIComponent(jsonStr))),
      sha
    };

    const putRes=await fetch(apiURL,{
      method:"PUT",
      headers:{Authorization:`token ${token}`,"Content-Type":"application/json"},
      body:JSON.stringify(putBody)
    });

    if(putRes.ok){document.getElementById("msg").innerHTML='<span class="success">‚úÖ Updated successfully!</span>';}
    else{const err=await putRes.json();document.getElementById("msg").innerHTML=`<span class="error">${err.message}</span>`;}
  }catch(err){document.getElementById("msg").innerHTML=`<span class="error">${err.message}</span>`;}
}
</script>
</body>
</html>
