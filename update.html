<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>KPL Live Admin (Auto Update)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: Poppins, sans-serif; background:#f4f4f4; padding:20px; max-width:800px; margin:auto; }
  h1 { text-align:center; color:#111; }
  select, input, textarea {
    width:100%; padding:10px; margin-bottom:10px; border:1px solid #ccc; border-radius:6px;
  }
  button { background:#007bff; color:white; border:none; padding:10px 16px; border-radius:6px; cursor:pointer; }
  button:hover { background:#0056b3; }
  pre { background:#111; color:#0f0; padding:10px; border-radius:8px; overflow-x:auto; }
  #msg { text-align:center; margin-top:15px; font-weight:600; }
  .success { color:green; } .error { color:red; }
</style>
</head>
<body>

<h1>üèè KPL Admin ‚Äî Live GitHub Auto Update</h1>
<p>Use this panel to update live scores directly to your GitHub repo.</p>

<h3>üîê Step 1 ‚Äî Connect GitHub</h3>
<input type="text" id="username" placeholder="Your GitHub Username (e.g. ultron3000)">
<input type="password" id="token" placeholder="Personal Access Token (starts with ghp_...)">

<h3>‚öôÔ∏è Step 2 ‚Äî Match Details</h3>
<select id="matchFile">
  <option value="match-1.json">Match 1: Titans vs Strikers</option>
  <option value="match-2.json">Match 2: Warriors vs Challengers</option>
  <option value="match-3.json">Match 3: Blazers vs Spartans</option>
  <option value="match-4.json">Match 4: Royals vs Mavericks</option>
  <option value="match-5.json">Match 5: Thunderbolts vs Gladiators</option>
</select>

<input id="match" placeholder="Match (e.g. Titans vs Strikers)">
<input id="venue" placeholder="Venue">
<input id="status" placeholder="Status (LIVE / Completed / Upcoming)">
<input id="score" placeholder="Score (e.g. 120/4)">
<input id="overs" placeholder="Overs (e.g. 12.3)">
<input id="runRate" placeholder="Run Rate (e.g. 9.45)">
<input id="target" placeholder="Target (optional)">
<textarea id="batsmen" placeholder='[{"name":"A. Patel","runs":25,"balls":15}]'></textarea>
<textarea id="bowlers" placeholder='[{"name":"M. Khan","overs":2,"runs":18,"wickets":1}]'></textarea>

<button onclick="generate()">Generate JSON</button>
<pre id="output">-- JSON output will appear here --</pre>

<h3>üöÄ Step 3 ‚Äî Push to GitHub</h3>
<button onclick="updateGitHub()">Save Live to GitHub</button>
<div id="msg"></div>

<script>
let latestJSON = "";

function generate() {
  try {
    const batsmen = JSON.parse(document.getElementById('batsmen').value || "[]");
    const bowlers = JSON.parse(document.getElementById('bowlers').value || "[]");
    const data = {
      match: document.getElementById('match').value,
      venue: document.getElementById('venue').value,
      status: document.getElementById('status').value,
      score: document.getElementById('score').value,
      overs: document.getElementById('overs').value,
      runRate: document.getElementById('runRate').value,
      target: document.getElementById('target').value,
      batsmen, bowlers,
      lastUpdated: new Date().toLocaleString()
    };
    latestJSON = JSON.stringify(data, null, 2);
    document.getElementById('output').textContent = latestJSON;
    document.getElementById('msg').innerHTML = "";
  } catch (err) {
    alert("Error parsing player data. Check JSON format.");
  }
}

async function updateGitHub() {
  const user = document.getElementById('username').value.trim();
  const token = document.getElementById('token').value.trim();
  const file = document.getElementById('matchFile').value;

  if (!user || !token) return alert("Please enter your GitHub username and token first!");
  if (!latestJSON) return alert("Generate JSON first!");

  const repo = "kpl"; // your repo name
  const path = "data/" + file;
  const apiURL = `https://api.github.com/repos/${user}/${repo}/contents/${path}`;

  try {
    // Step 1: get current file SHA
    const getRes = await fetch(apiURL, { headers: { Authorization: `token ${token}` }});
    const getData = await getRes.json();
    const sha = getData.sha;

    // Step 2: push updated content
    const body = {
      message: `Auto update ${file}`,
      content: btoa(unescape(encodeURIComponent(latestJSON))),
      sha
    };

    const putRes = await fetch(apiURL, {
      method: "PUT",
      headers: {
        Authorization: `token ${token}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify(body)
    });

    if (putRes.ok) {
      document.getElementById('msg').innerHTML = `<span class="success">‚úÖ Updated ${file} successfully!</span>`;
    } else {
      const err = await putRes.json();
      document.getElementById('msg').innerHTML = `<span class="error">‚ùå Error: ${err.message}</span>`;
    }
  } catch (err) {
    document.getElementById('msg').innerHTML = `<span class="error">‚ùå ${err.message}</span>`;
  }
}
</script>

</body>
</html>
